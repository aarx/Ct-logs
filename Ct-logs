#!/bin/bash

# Company name to search for
COMPANY="Cisco"

# URL for querying crt.sh
CRT_SH_URL="https://crt.sh/?q=$COMPANY&output=json"

# Fetch the CT logs related to the specified company
response=$(curl -s "$CRT_SH_URL")

# Check if the curl command was successful
if [[ $? -ne 0 ]]; then
  echo "Error: Failed to fetch the CT logs."
  exit 1
fi

# Check if there are any results
if [[ -z "$response" || "$response" == "[]" ]]; then
  echo "No Certificate Transparency logs found for $COMPANY."
  exit 0
fi

# Get the current date in a format compatible with certificate dates
current_date=$(date +%Y%m%d%H%M%S)

# Display the list of valid CT logs
echo "List of Valid Certificate Transparency Logs for $COMPANY:"
echo "---------------------------------------------------------"
echo "$response" | jq -r --arg current_date "$current_date" \
    '.[] | select(.not_before <= $current_date and .not_after >= $current_date) | 
    "\(.issuer_name) - \(.common_name) - Valid from \(.not_before) to \(.not_after)"'
